#include <stdio.h>
#include <time.h>
#include <string.h>

#include "pipe-message.h"

void pipe_message_print(pipe_message_t message, const char *prefix){
  time_t seconds = time(NULL);
  struct tm *timeinfo = localtime(&seconds);
  printf("%s: %04d-%02d-%02d %02d:%02d:%02d: %d: %s\n",prefix, 1900+timeinfo->tm_year, timeinfo->tm_mon+1, timeinfo->tm_mday, timeinfo->tm_hour, timeinfo->tm_min, timeinfo->tm_sec, message.pid, message.text);
}

int pipe_message_set_text(pipe_message_t *message, const char *text){
  if(strlen(text) > PIPE_MESSAGE_TEXT_SIZE){
    fprintf(stderr, "./pipe-main.out:%s:%d: Unable to set the \"%s\" message text because its \"%ld\" size is greater than \"%d\".\n", __FILE__, __LINE__, text, strlen(text), PIPE_MESSAGE_TEXT_SIZE);
    return -1;
  }
  strcpy(message->text, text);
  return 0;
}

int pipe_message_set_pid(pipe_message_t *message, pid_t pid){
  if (pid >= 0){
    message->pid = pid;
    return 0;
  }
  fprintf(stderr, "./pipe-main.out:%s:%d: Unable to set the \"%d\" PID because its value is less than or equal to \"0\".\n", __FILE__, __LINE__, pid);
  return -1;
}
